<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jchat.mem.mapper.MemFriendMapper">
    <sql id="comUserRelationSelectFrom">
        select
            c1.user_no
             , c1.id
             , c1.name
             , b1.alias_nm
             , c1.birth
             , b1.like_yn
             , b1.block_yn
        from
            tbo_user a1
                left join tbo_user_relation b1
                          on
                              a1.user_no = b1.user_no
                inner join tbo_user c1
                           on
                               b1.relation_user_no = c1.user_no
                                   and c1.secn_yn = 'N'
    </sql>

    <select id="searchFriendList" resultType="com.jchat.mem.dto.ComOtherUser">
        /* [memFriendService.searchFriendList] 친구목록조회 [juliet61008/25.12.18]*/
        <include refid="comUserRelationSelectFrom" />
        where
            a1.user_no = #{userNo}
        order by
            case
                when b1.like_yn = 'Y' then 0
                else 1
                end asc
                ,
            case
                when c1.name ~ '^[가-힣]' then 1
                when c1.name ~ '^[A-Za-z]' then 2
                else 3
                end asc,
            LOWER(c1.name) asc
    </select>
    <select id="searchUserList" resultType="com.jchat.mem.dto.SearchUserListResDto">
        /* [memFriendService.searchUserList] 유저정보 [juliet61008/25.12.03]*/
        with wt_user_relation_mine as (
            select b1.user_no
                    , b1.relation_user_no
                    , b1.alias_nm
            from tbo_user_relation
            where user_no = #{userNo}
        )
        select
                a1.user_no
                , a1.id
                , a1.name
                , b1.alias_nm
        from
                tbo_user a1
        left join
                wt_user_relation_mine b1
        on
                a1.user_no = b1.relation_user_no
        where
                a1.secn_yn = 'N' /* 탈퇴여부 */
            and a1.public_relation_yn = 'Y' /* 공개여부 */
            and a1.user_no <![CDATA[ <> ]]> #{userNo}
    </select>
</mapper>